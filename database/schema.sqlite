PRAGMA foreign_keys = ON;

-------------------------------
-- USERS w/ authentication, roles
-------------------------------
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT
    email TEXT NOT NULL UNIQUE,
    password_hash TEXT NOT NULL,
    role TEXT NOT NULL CHECK (role IN 'player', 'coach')),
);

--------------------------------
-- TEAMS 
--------------------------------
CREATE TABLE teams (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    team_name TEXT NOT NULL UNIQUE,
    season TEXT
);

--------------------------------
-- PLAYERS 
--------------------------------
CREATE TABLE players (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER UNIQUE,
    team_id INTEGER,
    jersey_number INTEGER,
    position TEXT,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL,
    FOREIGN KEY (team_id) REFERENCES teams(id) ON DELETE SET NULL
);

--------------------------------
-- GAMES 
--------------------------------
CREATE TABLE games (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    team_id INTEGER NOT NULL,
    player_id INTEGER NOT NULL,
    kills INTEGER DEFAULT 0,
    assists INTEGER DEFAULT 0,
    aces INTEGER DEFAULT 0,
    blocks INTEGER DEFAULT 0,
    digs INTEGER DEFAULT 0,
    season TEXT
    FOREIGN KEY (team_id) REFERENCES teams(id) ON DELETE CASCADE,
    FOREIGN KEY (player_id) REFERENCES players(id) ON DELETE CASCADE,
    UNIQUE (game_id, player_id)
);

--------------------------------
-- HEAT MAP EVENTS 
--------------------------------
CREATE TABLE heatmap_events (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    game_id INTEGER NOT NULL,
    player_id INTEGER NOT NULL,
    event_type TEXT NOT NULL,
    x REAL NOT NULL,
    y REAL NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (game_id) REFERENCES games(id) ON DELETE CASCADE,
    FOREIGN KEY (player_id) REFERENCES players(id) ON DELETE CASCADE
);


